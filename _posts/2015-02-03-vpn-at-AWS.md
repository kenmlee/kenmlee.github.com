---
layout: post
title: "在云主机上安装配置VPN"
description: ""
category: blog
tags: [vpn, cloud]
---
{% include JB/setup %}

以前在AWS上做了个自动安装VPN的程序，因为域名过期未续，就没再继续。可以最近又需要用VPN了，就想再申请一个一年免费的用用，没想到PPTP居然不工作了，查了下，看起来EC2不支持了。

<!--more-->

从AWS的论坛上看到[L2TP VPN issues](https://forums.aws.amazon.com/thread.jspa?messageID=320229)，结论是只能用SSTP，不能用PPTP和L2TP了，但是发现里面还是有很多问题：

帖子说EC2的security group只支持三种协议，ICMP, TCP, UDP，言下之意是说GRE无法通过security group，但是EC2的security group还提供制定义协议功能，你可以在协议里输入协议号（GRE是47），并且保存后可以看到security group里面显示的就是GRE协议。但是这个是不是假象呢？反正我在配置PPTP时是因为不支持GRE而无法使用。

帖子的结论是：

>PPTP won't work because it requires GRE (protocol 47)
>
>L2TP+IPsec won't work because it requires ESP (protocol 50)
>
>SSTP (Secure Socket Tunneling Protocol) will work because it encapsulates PPP inside an SSL connections. SSL runs over 443/TCP, which you can configure in a security group.

PPTP确实总是因为GRE协议问题无法工作。

L2TP却不是这样，我没有在securty group中配置ESP相关的条目，但是xl2tp确实可用（OS我用的是CentOS，Ubuntu还未试，有空也试试）。

SSTP，需要研究下，因为SSH Tunnel倒是可用的，但是客户端配置太麻烦（可以参见[这个](http://blog.csdn.net/quqi99/article/details/42292951)），但是iOS不支持，就没太大兴趣。

当然，还可以选择OpenVPN，可是，同样有客户端支持的问题，好在苹果对[OpenVPN](https://itunes.apple.com/us/app/openvpn-connect/id590379981)开放了，下次装一个服务端试试。如果支持on-demand的连接就更好了。

------
另外，有个VPN错误吗：

[VPN连接错误代码大全及VPN常见错误的解决方法(主要是针对pptpd与l2pt)](http://blog.woodbunny.com/post-57.html)
